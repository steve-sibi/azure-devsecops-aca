# Local run (Docker Compose)
API_KEY=local-dev-key
REQUIRE_API_KEY=true

QUEUE_NAME=tasks
SCAN_QUEUE_NAME=tasks-scan
QUEUE_BACKEND=redis
RESULT_BACKEND=redis

# Azure Table Storage `details` size guard (optional; default is 60000 on Table backend)
RESULT_DETAILS_MAX_BYTES=60000

# When using Docker Compose, service DNS names work (redis).
REDIS_URL=redis://redis:6379/0
REDIS_QUEUE_KEY=queue:tasks
REDIS_FETCHER_DLQ_KEY=dlq:tasks
REDIS_SCAN_QUEUE_KEY=queue:tasks-scan
REDIS_DLQ_KEY=dlq:tasks-scan
REDIS_RESULT_PREFIX=scan:
REDIS_RESULT_TTL_SECONDS=0

# Scan engines:
#   - reputation (domain/URL heuristics + optional allow/block lists)
#   - urlscan (optional external scan via urlscan.io; requires URLSCAN_API_KEY)
#   - urlhaus (optional external known-bad lookup via URLhaus; no API key)
#   - content (lightweight response body heuristics)
SCAN_ENGINE=reputation,content,urlhaus,urlscan
CONTENT_MAX_TEXT_BYTES=200000
CONTENT_MAX_BASE64_MATCH=50000

# External scanner (urlscan.io) — optional
# NOTE: urlscan.io free tier typically makes submissions public; avoid sending sensitive/internal URLs.
URLSCAN_API_KEY=
URLSCAN_VISIBILITY=public
URLSCAN_TIMEOUT_SECONDS=10
URLSCAN_MAX_WAIT_SECONDS=25
URLSCAN_POLL_INTERVAL_SECONDS=2
URLSCAN_SUSPICIOUS_SCORE=50
URLSCAN_MALICIOUS_SCORE=80

# External known-bad lookup (URLhaus) — optional (typically no API key; if you get 401, try setting URLHAUS_API_KEY)
# NOTE: no_results is NOT a proof of safety; it just means URLhaus didn't have a match.
URLHAUS_BASE_URL=https://urlhaus-api.abuse.ch/v1
URLHAUS_API_KEY=
URLHAUS_API_KEY_HEADER=Auth-Key
URLHAUS_TIMEOUT_SECONDS=10
URLHAUS_MATCH_WEIGHT=90

# URL/domain reputation (only used when SCAN_ENGINE includes "reputation")
# Supports exact hosts, "*.example.com", and ".example.com" suffix matches.
REPUTATION_ALLOWLIST_HOSTS=
REPUTATION_BLOCKLIST_HOSTS=
REPUTATION_MIN_SCORE=60
REPUTATION_BLOCK_ON_MALICIOUS=false
REPUTATION_SUSPICIOUS_TLDS=zip,top,xyz,click,icu,tk,gq,ml,cf,ga
REPUTATION_SUSPICIOUS_KEYWORDS=login,verify,update,secure,account,password,bank

# Demo markers (off by default)
# When enabled, URLs containing the substring "test-malicious" will be treated as malicious by the reputation engine.
ENABLE_DEMO_MARKERS=false

# Security defaults
BLOCK_PRIVATE_NETWORKS=true
RATE_LIMIT_RPM=60
RATE_LIMIT_WINDOW_SECONDS=60

# Fetcher -> analyzer handoff
ARTIFACT_DELETE_ON_SUCCESS=false

# File scanning (ClamAV)
# In Docker Compose, set CLAMAV_HOST=clamav (service name). In Azure Container Apps sidecar mode, use 127.0.0.1.
CLAMAV_HOST=clamav
CLAMAV_PORT=3310
CLAMAV_TIMEOUT_SECONDS=8
FILE_SCAN_MAX_BYTES=10485760
FILE_SCAN_INCLUDE_VERSION=true
